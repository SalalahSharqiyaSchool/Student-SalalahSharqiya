<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªÙ…ÙŠØ² | Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root { --emerald: #04241f; --gold: #af9164; --gemini-blue: #1a73e8; }
        
        * { box-sizing: border-box; }
        body { font-family: 'Almarai', sans-serif; background: var(--emerald); margin: 0; padding: 0; color: #fff; overflow-x: hidden; }

        /* --- ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ (Responsive Welcome) --- */
        .welcome-screen { 
            min-height: 100vh; display: flex; flex-direction: column; justify-content: space-between; 
            align-items: center; text-align: center; padding: 40px 20px;
            background: radial-gradient(circle at center, #064b3e 0%, var(--emerald) 100%);
        }
        .logos-area img { max-height: 100px; width: auto; }
        .platform-intro h1 { font-size: clamp(2rem, 8vw, 3.5rem); color: var(--gold); margin: 15px 0; }
        .platform-intro p { font-size: clamp(1rem, 4vw, 1.4rem); color: #ced4da; max-width: 700px; margin: 0 auto; }

        .exciting-btn {
            background: linear-gradient(135deg, var(--gold), #d4af37); color: white; border: none; 
            padding: 15px 40px; border-radius: 50px; font-weight: 800; font-size: 1.2rem; 
            cursor: pointer; transition: 0.4s; box-shadow: 0 0 15px rgba(175, 145, 100, 0.4);
            animation: pulse 2s infinite; margin-top: 30px;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(175, 145, 100, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(175, 145, 100, 0); } 100% { box-shadow: 0 0 0 0 rgba(175, 145, 100, 0); } }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        .login-view { display: none; height: 100vh; justify-content: center; align-items: center; padding: 20px; }
        .login-card { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); padding: 30px; border-radius: 25px; border: 1px solid var(--gold); text-align: center; width: 100%; max-width: 400px; }
        .login-card input { width: 100%; padding: 15px; margin: 20px 0; border-radius: 12px; border: 2px solid var(--gold); background: #fff; color: #333; font-size: 1.1rem; text-align: center; }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ --- */
        #topNav { position: fixed; top: 0; width: 100%; padding: 10px 5%; display: none; justify-content: space-between; align-items: center; background: var(--emerald); border-bottom: 2px solid var(--gold); z-index: 1000; }

        /* --- Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ¬ÙŠØ¨Ø© (Smart A4) --- */
        #resultView { display: none; background: #f0f2f5; color: #333; padding: 80px 10px 40px 10px; }
        .a4-page { 
            background: white; width: 100%; max-width: 210mm; margin: 0 auto; 
            padding: clamp(15px, 5vw, 40px); border: 10px double var(--emerald); 
            box-sizing: border-box; box-shadow: 0 5px 25px rgba(0,0,0,0.1);
        }
        .report-header { border-bottom: 3px solid var(--emerald); padding-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; background: #f8f9fa; padding: 15px; border-radius: 10px; font-size: 0.9rem; }
        
        .table-wrapper { overflow-x: auto; }
        .grades-table { width: 100%; border-collapse: collapse; min-width: 400px; }
        .grades-table th { background: var(--emerald); color: var(--gold); padding: 12px; border: 1px solid #ddd; }
        .grades-table td { padding: 10px; border: 1px solid #ddd; text-align: center; font-weight: 700; }

        /* --- Gemini AI Analyst --- */
        .ai-float { position: fixed; bottom: 20px; left: 20px; z-index: 2000; display: none; }
        .ai-icon { width: 60px; height: 60px; background: linear-gradient(135deg, #1a73e8, #8ab4f8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .ai-window { position: absolute; bottom: 70px; left: 0; width: min(320px, 85vw); background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; flex-direction: column; overflow: hidden; border-top: 5px solid var(--gemini-blue); }
        .ai-body { padding: 15px; height: 280px; overflow-y: auto; font-size: 0.85rem; }
        .gemini-msg { background: #e8f0fe; padding: 10px; border-radius: 10px; border-right: 4px solid var(--gemini-blue); margin-bottom: 10px; }

        /* --- Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; z-index: 3000; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 450px; text-align: center; color: #333; }
        .rank-box { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin-top: 20px; }
        .rank-card { background: #f8f9fa; padding: 10px; border-radius: 10px; border: 2px solid #eee; flex: 1; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            #resultView { display: block !important; padding: 0; }
            .a4-page { border: none; box-shadow: none; max-width: 100%; }
        }

        @media (max-width: 600px) {
            .report-header { text-align: center; justify-content: center; }
            .report-header div { width: 100%; }
        }
    </style>
</head>
<body>

<nav id="topNav" class="no-print">
    <div style="color:var(--gold); font-weight:800; font-size: 0.9rem;">Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</div>
    <div>
        <button onclick="openTops()" style="background:var(--gold); color:white; border:none; padding:6px 12px; border-radius:8px; cursor:pointer; font-size: 0.8rem;">Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ ğŸ†</button>
        <button onclick="location.reload()" style="background:white; color:var(--emerald); border:none; padding:6px 12px; border-radius:8px; cursor:pointer; margin-right:5px; font-size: 0.8rem;">Ø®Ø±ÙˆØ¬</button>
    </div>
</nav>

<div id="welcomeView" class="welcome-screen no-print">
    <div class="logos-area">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Oman_Ministry_of_Education_Logo.svg/1200px-Oman_Ministry_of_Education_Logo.svg.png" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ©">
    </div>
    <div class="platform-intro">
        <h1>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªÙ…ÙŠØ² Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
        <p>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© (5-10)<br>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ | 2025/2026 Ù…</p>
        <button class="exciting-btn" onclick="showLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</button>
    </div>
    <div style="font-size: 0.8rem; color: var(--gold); opacity: 0.8;">
        ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: <b>Ø£. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ø±ÙŠØ¨ÙŠ</b>
    </div>
</div>

<div id="loginView" class="login-view no-print">
    <div class="login-card">
        <i class="fa-solid fa-lock-open" style="font-size: 3rem; color: var(--gold); margin-bottom: 10px;"></i>
        <h2 style="color: white; margin: 0;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h2>
        <input type="text" id="stdId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ">
        <button class="exciting-btn" style="width:100%; margin:0;" onclick="startApp()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>
</div>

<div class="ai-float no-print" id="aiBot">
    <div class="ai-window" id="aiWin">
        <div style="background:var(--gemini-blue); color:white; padding:10px; display:flex; justify-content:space-between;">
            <span>Gemini Analyst</span><span style="cursor:pointer" onclick="toggleAI()">Ã—</span>
        </div>
        <div class="ai-body" id="chatContainer"></div>
        <div style="display:flex; padding:8px; border-top:1px solid #eee;">
            <input type="text" id="aiInput" placeholder="Ø§Ø³Ø£Ù„ Ø§Ù„Ø±ÙˆØ¨ÙˆØª..." style="flex:1; border:1px solid #ddd; padding:8px; border-radius:8px; font-size:0.8rem;">
            <button onclick="askGemini()" style="background:var(--gemini-blue); color:white; border:none; padding:8px; border-radius:8px; margin-right:4px;"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>
    <div class="ai-icon" onclick="toggleAI()"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
</div>

<div id="resultView">
    <div class="a4-page">
        <div class="report-header">
            <div>Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†<br>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…<br><b>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</b></div>
            <img src="logo.png" height="60" onerror="this.style.display='none'">
            <div style="text-align: left;">ÙƒØ´Ù Ø§Ù„Ø¯Ø±Ø¬Ø§Øª<br>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„<br>2025/2026 Ù…</div>
        </div>
        <div class="info-grid" id="infoBox"></div>
        <div class="table-wrapper">
            <table class="grades-table">
                <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <div style="margin-top: 30px; display: flex; justify-content: space-between; font-size: 0.8rem;">
            <div>ØªÙˆÙ‚ÙŠØ¹ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ...........</div>
            <div style="text-align: center;">ÙŠØ¹ØªÙ…Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
        </div>
    </div>
    <div class="no-print" style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" class="exciting-btn" style="padding:12px 30px; font-size: 1rem;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙˆØ±Ù‚ÙŠØ©</button>
    </div>
</div>

<div class="modal" id="topsModal">
    <div class="modal-content">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ğŸ†</h3>
        <div class="rank-box" id="topsList"></div>
        <button onclick="document.getElementById('topsModal').style.display='none'" class="exciting-btn" style="font-size:0.9rem; padding:8px 20px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let student = null;
    let classmates = [];

    function showLogin() {
        document.getElementById('welcomeView').style.display = 'none';
        document.getElementById('loginView').style.display = 'flex';
    }

    async function startApp() {
        const id = document.getElementById('stdId').value.trim();
        const files = ["grade5.json", "grade6.json", "grade7.json", "grade8.json", "grade9.json"];
        for (let f of files) {
            try {
                const res = await fetch(f + "?v=" + Date.now());
                const data = await res.json();
                student = data.find(s => s["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ"].toString() === id);
                if(student) { classmates = data.filter(c => c["Ø§Ù„ØµÙ"] === student["Ø§Ù„ØµÙ"]); break; }
            } catch(e) {}
        }
        if(student) {
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('topNav').style.display = 'flex';
            document.getElementById('resultView').style.display = 'block';
            document.getElementById('aiBot').style.display = 'block';
            renderUI();
        } else { alert("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯."); }
    }

    function renderUI() {
        document.getElementById('infoBox').innerHTML = `
            <div>Ø§Ù„Ø§Ø³Ù…: <b>${student["Ø§Ù„Ø§Ø³Ù…"]}</b></div>
            <div>Ø§Ù„ØµÙ: <b>${student["Ø§Ù„ØµÙ"]} / ${student["Ø§Ù„Ø´Ø¹Ø¨Ø©"]}</b></div>
        `;
        const subs = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        let html = "";
        subs.forEach(sub => {
            const v = parseFloat(student[sub]);
            html += `<tr><td style="text-align:right;">${sub}</td><td>${v}</td><td>${v>=90?'Ù…Ù…ØªØ§Ø²':'Ø¬ÙŠØ¯'}</td></tr>`;
        });
        document.getElementById('tableBody').innerHTML = html;
    }

    function toggleAI() {
        const win = document.getElementById('aiWin');
        if (win.style.display === 'none' || win.style.display === '') {
            const subs = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
            const avg = (subs.reduce((a, b) => a + parseFloat(student[b]), 0) / subs.length).toFixed(1);
            const hints = [
                `Ø£Ù‡Ù„Ø§Ù‹ ${student["Ø§Ù„Ø§Ø³Ù…"].split(' ')[0]}! Ù…Ø¹Ø¯Ù„Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ${avg} Ù…Ø¨Ø´Ø± Ø¬Ø¯Ø§Ù‹.`,
                `Ø°ÙƒØ§Ø¡ Gemini ÙŠØ­Ù„Ù„ Ø¯Ø±Ø¬Ø§ØªÙƒ.. Ø£Ù†Øª Ù…ØªÙÙˆÙ‚ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!`,
                `Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©: ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„ØŸ`
            ];
            document.getElementById('chatContainer').innerHTML = `<div class="gemini-msg">${hints[Math.floor(Math.random()*hints.length)]}</div>`;
            win.style.display = 'flex';
        } else { win.style.display = 'none'; }
    }

    function askGemini() {
        const input = document.getElementById('aiInput');
        if(!input.value) return;
        document.getElementById('chatContainer').innerHTML += `<div style="text-align:left; font-size:0.75rem; margin-bottom:5px;"><b>Ø£Ù†Øª:</b> ${input.value}</div>`;
        setTimeout(() => {
            document.getElementById('chatContainer').innerHTML += `<div class="gemini-msg">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ÙŠ Ù„Ø¯Ø±Ø¬Ø§ØªÙƒ ÙÙŠ ${student["Ø§Ù„ØµÙ"]}ØŒ Ø£Ù†ØµØ­Ùƒ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¦Ø¹!</div>`;
            document.getElementById('chatContainer').scrollTop = 9999;
        }, 600);
        input.value = "";
    }

    function openTops() {
        const subs = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        const list = classmates.map(c => ({
            name: c["Ø§Ù„Ø§Ø³Ù…"].split(' ')[0],
            total: subs.reduce((a, b) => a + parseFloat(c[b]||0), 0)
        })).sort((a,b) => b.total - a.total).slice(0, 3);
        document.getElementById('topsList').innerHTML = list.map((l, i) => `
            <div class="rank-card">
                <div style="font-size:1.2rem;">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]}</div>
                <div style="font-size:0.7rem; font-weight:800;">${l.name}</div>
                <div style="font-size:0.8rem; color:var(--emerald)">${l.total}</div>
            </div>`).join('');
        document.getElementById('topsModal').style.display = 'flex';
    }
</script>
</body>
</html>
