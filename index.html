<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªÙ…ÙŠØ² | Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root { --emerald: #04241f; --gold: #af9164; --silver: #e0e0e0; --gemini-blue: #1a73e8; }
        
        body { font-family: 'Almarai', sans-serif; background: var(--emerald); margin: 0; padding: 0; color: #fff; overflow-x: hidden; }

        /* --- ØµÙØ­Ø© ØªØ±Ø­ÙŠØ¨ Ù…ÙˆØ²Ø¹Ø© (Cinematic Welcome) --- */
        .welcome-screen { 
            height: 100vh; display: flex; flex-direction: column; justify-content: space-between; 
            align-items: center; text-align: center; padding: 60px 20px; box-sizing: border-box;
            background: radial-gradient(circle at center, #064b3e 0%, var(--emerald) 100%);
        }
        .logos-area { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .platform-intro { max-width: 800px; }
        .platform-intro h1 { font-size: 3.5rem; color: var(--gold); margin: 10px 0; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .platform-intro p { font-size: 1.4rem; color: #ced4da; line-height: 1.8; }

        /* Ø²Ø± Ø¯Ø®ÙˆÙ„ Ù…Ø«ÙŠØ± (Exciting Pulse Button) */
        .exciting-btn {
            background: linear-gradient(135deg, var(--gold), #d4af37); color: white; border: none; 
            padding: 20px 60px; border-radius: 50px; font-weight: 800; font-size: 1.5rem; 
            cursor: pointer; position: relative; overflow: hidden; transition: 0.4s;
            box-shadow: 0 0 20px rgba(175, 145, 100, 0.4); animation: pulse 2s infinite;
        }
        .exciting-btn:hover { transform: scale(1.1); box-shadow: 0 0 40px var(--gold); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(175, 145, 100, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(175, 145, 100, 0); } 100% { box-shadow: 0 0 0 0 rgba(175, 145, 100, 0); } }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        .login-view { display: none; height: 100vh; justify-content: center; align-items: center; }
        .login-card { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); padding: 50px; border-radius: 30px; border: 1px solid var(--gold); text-align: center; width: 90%; max-width: 420px; }
        .login-card input { width: 100%; padding: 18px; margin: 25px 0; border-radius: 15px; border: 2px solid var(--gold); background: transparent; color: white; font-size: 1.3rem; text-align: center; }

        /* --- ÙƒØ´Ù Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (A4 Engineering) --- */
        #resultView { display: none; background: #f0f2f5; color: #333; padding: 20px 0; min-height: 100vh; }
        .a4-page { background: white; width: 210mm; margin: 0 auto; padding: 40px; border: 15px double var(--emerald); box-sizing: border-box; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .report-header { border-bottom: 4px solid var(--emerald); padding-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; background: #f8f9fa; padding: 20px; border-radius: 15px; }
        .grades-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .grades-table th { background: var(--emerald); color: var(--gold); padding: 15px; border: 1px solid #ddd; }
        .grades-table td { padding: 12px; border: 1px solid #ddd; text-align: center; font-weight: 800; font-size: 1.1rem; }

        /* --- Ø±ÙˆØ¨ÙˆØª Gemini Ø§Ù„Ù…Ø·ÙˆØ± --- */
        .ai-float { position: fixed; bottom: 30px; left: 30px; z-index: 2000; display: none; }
        .ai-icon { width: 75px; height: 75px; background: linear-gradient(135deg, #1a73e8, #8ab4f8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2.2rem; cursor: pointer; box-shadow: 0 10px 25px rgba(26,115,232,0.4); transition: 0.3s; }
        .ai-window { position: absolute; bottom: 90px; left: 0; width: 350px; background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); border-top: 5px solid var(--gemini-blue); display: none; flex-direction: column; overflow: hidden; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .ai-head { background: #f8f9fa; color: var(--gemini-blue); padding: 15px; font-weight: 800; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .ai-body { padding: 20px; height: 320px; overflow-y: auto; font-size: 0.95rem; color: #444; }
        .gemini-msg { background: #e8f0fe; padding: 12px; border-radius: 15px; border-right: 4px solid var(--gemini-blue); margin-bottom: 15px; line-height: 1.6; }
        .user-msg { text-align: left; background: #f1f3f4; padding: 10px; border-radius: 12px; margin: 10px 0; }

        /* --- Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù… --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 40px; border-radius: 30px; border: 5px solid var(--gold); width: 90%; max-width: 480px; text-align: center; color: #333; }
        .rank-box { display: flex; justify-content: space-around; align-items: flex-end; margin-top: 30px; }
        .rank-card { background: #fdfdfd; padding: 15px; border-radius: 15px; width: 30%; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 2px solid #eee; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            #resultView { display: block !important; padding: 0; }
            .a4-page { border: none; margin: 0; width: 100%; padding: 0; }
            @page { size: A4; margin: 1.5cm; }
        }
    </style>
</head>
<body>

<nav id="topNav" class="no-print" style="position:fixed; top:0; width:100%; padding:15px 50px; display:none; justify-content:space-between; align-items:center; background:rgba(4,36,31,0.9); border-bottom:1px solid var(--gold); z-index:1000;">
    <div style="color:var(--gold); font-weight:800;">Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</div>
    <div>
        <button onclick="openTops()" style="background:var(--gold); color:white; border:none; padding:8px 20px; border-radius:10px; cursor:pointer; font-weight:700;">Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ ğŸ†</button>
        <button onclick="location.reload()" style="background:transparent; color:white; border:1px solid white; padding:8px 20px; border-radius:10px; cursor:pointer; margin-right:10px;">Ø®Ø±ÙˆØ¬</button>
    </div>
</nav>

<div id="welcomeView" class="welcome-screen no-print">
    <div class="logos-area">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Oman_Ministry_of_Education_Logo.svg/1200px-Oman_Ministry_of_Education_Logo.svg.png" height="120" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ©">
        <h2 style="color:white; letter-spacing: 2px;">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…</h2>
    </div>

    <div class="platform-intro">
        <h1>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªÙ…ÙŠØ² Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
        <p>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© (5-10)<br>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ | Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025/2026 Ù…</p>
        <div style="margin-top: 40px;">
            <button class="exciting-btn" onclick="showLogin()">Ø§ÙƒØªØ´Ù Ù†ØªØ§Ø¦Ø¬Ùƒ Ø§Ù„Ø¢Ù†</button>
        </div>
    </div>

    <div style="font-size: 1rem; color: var(--gold); border-top: 1px solid rgba(175,145,100,0.3); padding-top: 20px; width: 80%;">
        ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø¨Ø¯Ø¹: <b>Ø£. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ø±ÙŠØ¨ÙŠ</b>
    </div>
</div>

<div id="loginView" class="login-view no-print">
    <div class="login-card">
        <i class="fa-solid fa-fingerprint" style="font-size: 4rem; color: var(--gold);"></i>
        <h2>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø°ÙƒÙŠ</h2>
        <input type="text" id="stdId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ">
        <button class="exciting-btn" style="padding:15px; width:100%; font-size:1.2rem;" onclick="startApp()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
</div>

<div class="ai-float no-print" id="aiBot">
    <div class="ai-window" id="aiWin">
        <div class="ai-head"><span>Gemini AI Analyst</span><span style="cursor:pointer" onclick="toggleAI()">Ã—</span></div>
        <div class="ai-body" id="chatContainer"></div>
        <div style="display:flex; padding:10px; border-top:1px solid #eee;">
            <input type="text" id="aiInput" placeholder="Ø§Ø³Ø£Ù„ Gemini Ø¹Ù† Ù…Ø³ØªÙˆØ§Ùƒ..." style="flex:1; border:1px solid #ddd; padding:10px; border-radius:10px; outline:none;">
            <button onclick="askGemini()" style="background:var(--gemini-blue); color:white; border:none; margin-right:5px; padding:10px; border-radius:10px;"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>
    <div class="ai-icon" onclick="toggleAI()"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
</div>

<div id="resultView">
    <div class="a4-page">
        <div class="report-header">
            <div>Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†<br>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…<br><b>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© (5-10)</b></div>
            <img src="logo.png" height="80" onerror="this.style.display='none'">
            <div style="text-align: left;">ÙƒØ´Ù Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠ<br>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„<br>2025/2026 Ù…</div>
        </div>
        <div class="info-grid" id="infoBox"></div>
        <table class="grades-table">
            <thead>
                <tr><th>Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø© (100)</th><th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <div style="margin-top: 50px; display: flex; justify-content: space-between;">
            <div>ØªÙˆÙ‚ÙŠØ¹ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ...................</div>
            <div style="text-align: center;">ÙŠØ¹ØªÙ…Ø¯ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©<br><br><b>Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</b></div>
        </div>
    </div>
    <div class="no-print" style="text-align: center; margin-top: 30px;">
        <button onclick="window.print()" class="exciting-btn" style="padding:15px 50px;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© (A4)</button>
    </div>
</div>

<div class="modal" id="topsModal">
    <div class="modal-content">
        <h2 style="color:var(--emerald); border-bottom:3px solid var(--gold); padding-bottom:15px;">Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©</h2>
        <div class="rank-box" id="topsList"></div>
        <button onclick="document.getElementById('topsModal').style.display='none'" class="exciting-btn" style="margin-top:40px; font-size:1rem; padding:10px 30px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let student = null;
    let classmates = [];

    function showLogin() {
        document.getElementById('welcomeView').style.display = 'none';
        document.getElementById('loginView').style.display = 'flex';
    }

    async function startApp() {
        const id = document.getElementById('stdId').value.trim();
        const files = ["grade5.json", "grade6.json", "grade7.json", "grade8.json", "grade9.json"];
        
        for (let f of files) {
            try {
                const res = await fetch(f + "?v=" + Date.now());
                const data = await res.json();
                student = data.find(s => s["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ"].toString() === id);
                if(student) { classmates = data.filter(c => c["Ø§Ù„ØµÙ"] === student["Ø§Ù„ØµÙ"]); break; }
            } catch(e) {}
        }

        if(student) {
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('topNav').style.display = 'flex';
            document.getElementById('resultView').style.display = 'block';
            document.getElementById('aiBot').style.display = 'block';
            renderUI();
        } else { alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„."); }
    }

    function renderUI() {
        document.getElementById('infoBox').innerHTML = `
            <div>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: <b>${student["Ø§Ù„Ø§Ø³Ù…"]}</b></div>
            <div>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ: <b>${student["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ"]}</b></div>
            <div>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: <b>${student["Ø§Ù„ØµÙ"]}</b></div>
            <div>Ø§Ù„Ø´Ø¹Ø¨Ø©: <b>${student["Ø§Ù„Ø´Ø¹Ø¨Ø©"]}</b></div>`;

        const subjects = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        let html = "";
        subjects.forEach(sub => {
            const v = parseFloat(student[sub]);
            html += `<tr><td style="text-align:right;">${sub}</td><td>${v}</td><td>${v>=90?'Ù…Ù…ØªØ§Ø²':'Ø¬ÙŠØ¯'}</td></tr>`;
        });
        document.getElementById('tableBody').innerHTML = html;
    }

    function toggleAI() {
        const win = document.getElementById('aiWin');
        if (win.style.display === 'none' || win.style.display === '') {
            resetGemini(); // Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
            win.style.display = 'flex';
        } else {
            win.style.display = 'none';
        }
    }

    function resetGemini() {
        const container = document.getElementById('chatContainer');
        const subjects = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        const avg = (subjects.reduce((a, b) => a + parseFloat(student[b]), 0) / subjects.length).toFixed(1);
        
        const insights = [
            `Ø£Ù‡Ù„Ø§Ù‹ ${student["Ø§Ù„Ø§Ø³Ù…"].split(' ')[0]}! Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„Ùƒ ÙˆÙ‡Ùˆ (${avg}). Ø£Ù†Øª ØªÙ…ØªÙ„Ùƒ Ù‚Ø¯Ø±Ø§Øª Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©!`,
            `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ. Ù†Ø¸Ø§Ù… Gemini ÙŠØ±Ù‰ Ø£Ù† Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ù…ØªØ·ÙˆØ±Ø© Ø¬Ø¯Ø§Ù‹. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ`,
            `ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ: Ø¯Ø±Ø¬Ø§ØªÙƒ ØªØ¸Ù‡Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹. Ù…Ø¹Ø¯Ù„Ùƒ ${avg} ÙŠØ¶Ø¹Ùƒ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ².`
        ];
        
        container.innerHTML = `<div class="gemini-msg">${insights[Math.floor(Math.random() * insights.length)]}</div>`;
    }

    function askGemini() {
        const input = document.getElementById('aiInput');
        if(!input.value) return;
        const container = document.getElementById('chatContainer');
        container.innerHTML += `<div class="user-msg"><b>Ø£Ù†Øª:</b> ${input.value}</div>`;
        
        setTimeout(() => {
            container.innerHTML += `<div class="gemini-msg">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø°ÙƒØ§Ø¦ÙŠ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ Ø£Ù†ØµØ­Ùƒ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‡Ø¬ ÙˆØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°Ø§ØªÙŠ Ù„Ø±ÙØ¹ Ù…Ø¹Ø¯Ù„Ùƒ Ø£ÙƒØ«Ø± ÙÙŠ Ø§Ù„ÙØµÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù….</div>`;
            container.scrollTop = container.scrollHeight;
        }, 800);
        input.value = "";
    }

    function openTops() {
        const subs = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        const list = classmates.map(c => ({
            name: c["Ø§Ù„Ø§Ø³Ù…"].split(' ')[0],
            total: subs.reduce((a, b) => a + parseFloat(c[b]||0), 0)
        })).sort((a,b) => b.total - a.total).slice(0, 3);

        document.getElementById('topsList').innerHTML = list.map((l, i) => `
            <div class="rank-card" style="height:${100 - i*15}px; border-color:${['gold','silver','#cd7f32'][i]}">
                <div style="font-size:1.5rem;">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]}</div>
                <div style="font-weight:800; font-size:0.8rem;">${l.name}</div>
                <div style="color:var(--emerald)">${l.total}</div>
            </div>`).join('');
        document.getElementById('topsModal').style.display = 'flex';
    }
</script>

</body>
</html>
