<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root {
            --oman-green: #0b4d42;
            --oman-gold: #b38e44;
            --bg-sand: #fcf9f2;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Almarai', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            background-color: var(--bg-sand); 
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png');
            color: #2d3436;
            overflow-x: hidden;
        }

        /* Ù‡ÙŠØ¯Ø± Ø§Ù„Ù‡Ø§ØªÙ */
        header {
            background: var(--oman-green);
            color: white; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 4px solid var(--oman-gold);
            position: sticky; top: 0; z-index: 100;
        }
        header h1 { font-size: 1rem; font-weight: 800; }
        header img { height: 45px; }

        .container { padding: 20px; max-width: 600px; margin: 0 auto; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø« - ØªØµÙ…ÙŠÙ… Ù…Ø±ÙŠØ­ Ù„Ù„ÙŠØ¯ */
        .search-card {
            background: var(--white); border-radius: 25px; padding: 30px 20px;
            box-shadow: var(--shadow); text-align: center; margin-top: 20px;
        }
        .search-card i { font-size: 3rem; color: var(--oman-gold); margin-bottom: 15px; }
        
        input {
            width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #eee;
            font-size: 1.2rem; text-align: center; margin-bottom: 20px; outline: none;
            transition: 0.3s; background: #fafafa;
        }
        input:focus { border-color: var(--oman-gold); background: white; }

        .btn-action {
            width: 100%; padding: 16px; border-radius: 12px; border: none;
            background: var(--oman-green); color: white; font-weight: 800;
            font-size: 1.1rem; cursor: pointer; transition: 0.3s;
        }
        .btn-action:active { transform: scale(0.98); }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù‡Ø§ØªÙ */
        #resultView { display: none; animation: slideUp 0.5s ease; }
        .profile-strip {
            background: var(--white); border-radius: 20px; padding: 20px;
            border-right: 6px solid var(--oman-gold); margin-bottom: 15px; box-shadow: var(--shadow);
        }
        .profile-strip h2 { font-size: 1.2rem; color: var(--oman-green); }

        .table-mobile {
            background: white; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow);
        }
        .data-row {
            display: flex; justify-content: space-between; padding: 15px 20px;
            border-bottom: 1px solid #f2f2f2; align-items: center;
        }
        .data-row:last-child { border-bottom: none; }
        .label-sub { font-weight: 700; color: #555; }
        .score-sub { 
            background: #e9f5f2; color: var(--oman-green); 
            padding: 5px 12px; border-radius: 8px; font-weight: 800; 
        }

        /* --- Ø§Ù„Ø±ÙˆØ¨ÙˆØª ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© Ù„Ù„Ù‡Ø§ØªÙ --- */
        #robotFAB {
            position: fixed; bottom: 25px; left: 20px; z-index: 1000;
            display: none; flex-direction: column; align-items: center;
        }
        .robot-circle {
            width: 65px; height: 65px; background: var(--oman-green);
            border: 3px solid var(--oman-gold); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2); animation: float 3s infinite ease-in-out;
        }
        .robot-circle img { width: 70%; height: 70%; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .analysis-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center;
            align-items: center; z-index: 2000; backdrop-filter: blur(5px);
            padding: 20px;
        }
        .analysis-popup {
            background: white; border-radius: 30px; width: 100%; max-width: 350px;
            padding: 30px; border-top: 8px solid var(--oman-gold);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); position: relative;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        @media print { .no-print, #robotFAB { display: none !important; } }
    </style>
</head>
<body>

<header>
    <img src="logo.png" alt="Logo">
    <h1>Ø¨ÙˆØ§Ø¨Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</h1>
    <div style="font-size: 1.2rem; color: var(--oman-gold);"><i class="fa-solid fa-bars-staggered"></i></div>
</header>

<div class="container">
    <section id="searchView" class="no-print">
        <div class="search-card">
            <i class="fa-solid fa-fingerprint"></i>
            <h2 style="margin-bottom: 10px;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„</h2>
            <p style="font-size: 0.8rem; color: #777; margin-bottom: 25px;">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ù…Ø¯Ù†ÙŠ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù†ØªÙŠØ¬ØªÙƒ</p>
            <input type="number" id="civilID" placeholder="00000000" pattern="\d*">
            <button class="btn-action" onclick="handleSearch()">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        </div>
    </section>

    <section id="resultView">
        <div class="profile-strip">
            <h2 id="stName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <p id="stDetails" style="font-size: 0.85rem; margin-top: 5px; color: #666;"></p>
            <div style="margin-top: 10px; font-weight: 800; color: var(--oman-gold);">Ø§Ù„Ù…Ø¹Ø¯Ù„: <span id="stAvg">0%</span></div>
        </div>

        <div class="table-mobile" id="stData">
            </div>

        <button class="btn-action no-print" onclick="location.reload()" style="background:none; color:var(--oman-green); border:2px solid var(--oman-green); margin-top:20px;">Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</button>
    </section>
</div>

<div id="robotFAB" class="no-print" onclick="toggleAnalysis(true)">
    <div style="background:var(--oman-gold); color:white; font-size:0.6rem; padding:3px 8px; border-radius:8px; margin-bottom:5px; font-weight:bold;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡</div>
    <div class="robot-circle">
        <img src="https://pollinations.ai/p/friendly%20robot%20face%20with%20traditional%20omani%20gold%20elements?width=100&height=100&nologo=true" alt="Robot">
    </div>
</div>

<div class="analysis-overlay" id="overlay" onclick="toggleAnalysis(false)">
    <div class="analysis-popup" onclick="event.stopPropagation()">
        <h3 style="color:var(--oman-green); margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:10px;">
            <i class="fa-solid fa-chart-line"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ Ø§Ù„Ø°ÙƒÙŠ
        </h3>
        <div id="analysisBody" style="font-size: 0.9rem; line-height: 1.6; color: #444;"></div>
        <button class="btn-action" onclick="toggleAnalysis(false)" style="margin-top:20px; background:var(--oman-gold);">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ</button>
    </div>
</div>

<script>
    let student = null;

    async function handleSearch() {
        const id = document.getElementById('civilID').value.trim();
        const files = ["grade5.json", "grade6.json", "grade7.json", "grade8.json", "grade9.json"];
        
        for(let f of files) {
            try {
                const r = await fetch(f);
                const data = await r.json();
                student = data.find(s => s["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ"].toString() === id);
                if(student) { renderUI(); return; }
            } catch(e) {}
        }
        alert("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
    }

    function renderUI() {
        const keys = Object.keys(student).filter(k => !["Ø±Ù‚Ù…_Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„ØµÙ", "Ø§Ù„Ø´Ø¹Ø¨Ø©"].includes(k));
        const scores = keys.map(k => parseFloat(student[k]));
        const avg = (scores.reduce((a,b)=>a+b,0) / keys.length).toFixed(1);

        document.getElementById('stName').innerText = student["Ø§Ù„Ø§Ø³Ù…"];
        document.getElementById('stDetails').innerText = `Ø§Ù„ØµÙ: ${student["Ø§Ù„ØµÙ"]} | Ø§Ù„Ø´Ø¹Ø¨Ø©: ${student["Ø§Ù„Ø´Ø¹Ø¨Ø©"]}`;
        document.getElementById('stAvg').innerText = avg + "%";

        let html = '';
        keys.forEach(k => {
            html += `<div class="data-row">
                        <span class="label-sub">${k}</span>
                        <span class="score-sub">${student[k]}</span>
                     </div>`;
        });
        document.getElementById('stData').innerHTML = html;

        document.getElementById('searchView').style.display = 'none';
        document.getElementById('resultView').style.display = 'block';
        document.getElementById('robotFAB').style.display = 'flex';

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„
        const high = keys[scores.indexOf(Math.max(...scores))];
        document.getElementById('analysisBody').innerHTML = `
            <p>Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ <b>${student["Ø§Ù„Ø§Ø³Ù…"].split(' ')[0]}</b>ØŒ Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ­Ù„ÙŠÙ„ Ø¯Ø±Ø¬Ø§ØªÙƒ:</p>
            <ul>
                <li style="margin-top:10px;">ğŸŒŸ Ø£Ù†Øª Ù…ØªÙÙˆÙ‚ Ø¬Ø¯Ø§Ù‹ ÙÙŠ <b>${high}</b>.</li>
                <li style="margin-top:10px;">ğŸ“ˆ Ù…Ø¹Ø¯Ù„Ùƒ Ø§Ù„Ø¹Ø§Ù… <b>${avg}%</b> ÙŠØ¶Ø¹Ùƒ ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ù…Ù…ØªØ§Ø².</li>
                <li style="margin-top:10px;">ğŸ’¡ Ù†ØµÙŠØ­ØªÙŠ: Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯Ø±ÙˆØ³Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø£ÙˆÙ„.</li>
            </ul>
        `;
    }

    function toggleAnalysis(show) {
        document.getElementById('overlay').style.display = show ? 'flex' : 'none';
    }
</script>
</body>
</html>
