<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>بوابة صلالة الشرقية | المحلل الذكي العماني</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root {
            --oman-green: #062a24;
            --oman-gold: #c5a059;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Almarai', sans-serif; }

        body { 
            background-color: #fdfaf5; 
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png');
            color: #2d3436;
        }

        /* الهيدر الرسمي */
        header {
            background: linear-gradient(135deg, var(--oman-green) 0%, #052c26 100%);
            color: white; padding: 20px 5%;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 5px solid var(--oman-gold);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .school-logo img { height: 60px; }

        .container { width: 92%; max-width: 900px; margin: 30px auto; }

        /* واجهة البحث */
        #searchBox {
            max-width: 450px; margin: 100px auto; text-align: center;
            background: var(--white); padding: 40px; border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        }
        input { 
            width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #eee; 
            text-align: center; font-size: 1.4rem; outline: none; margin-bottom: 20px;
        }
        .btn-main { 
            width: 100%; padding: 18px; background: var(--oman-green); color: white; 
            border: none; border-radius: 15px; font-weight: 800; cursor: pointer;
        }

        /* كشف الدرجات */
        #resultView { display: none; animation: fadeIn 0.8s ease; }
        .result-card { background: white; border-radius: 25px; padding: 30px; border: 1px solid #eee; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: right; padding: 15px; background: #f8f9fa; color: var(--oman-green); border-bottom: 2px solid var(--oman-gold); }
        td { padding: 15px; border-bottom: 1px solid #f1f1f1; font-weight: 700; }

        /* --- الروبوت والبطاقة العائمة --- */
        #aiComponent {
            position: fixed; bottom: 30px; left: 30px; z-index: 9999;
            display: none; flex-direction: column; align-items: center;
        }

        /* الروبوت */
        .robot-btn {
            width: 70px; height: 70px; background: var(--oman-green);
            border: 3px solid var(--oman-gold); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: float 3s infinite ease-in-out;
        }
        .robot-btn img { width: 75%; height: 75%; }

        /* البطاقة العائمة */
        .floating-analysis {
            position: absolute; bottom: 85px; left: 0; width: 320px;
            background: var(--glass); backdrop-filter: blur(10px);
            border-radius: 25px; border: 2px solid var(--oman-gold);
            padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            display: none; animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .analysis-h { color: var(--oman-green); font-weight: 800; margin-bottom: 15px; border-bottom: 1px solid var(--oman-gold); padding-bottom: 10px; }
        .analysis-item { font-size: 0.85rem; margin-bottom: 10px; line-height: 1.6; color: #444; }
        .tag { background: var(--oman-gold); color: white; padding: 2px 8px; border-radius: 5px; font-size: 0.7rem; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes popUp { from { opacity: 0; transform: scale(0.5) translateY(50px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media print { .no-print, #aiComponent { display: none !important; } }
    </style>
</head>
<body>

<header>
    <div class="school-logo"><img src="logo.png" alt="Logo"></div>
    <div style="text-align: center;">
        <h1 style="font-size: 1.2rem; color: var(--oman-gold);">بوابة المحلل الذكي الرقمية</h1>
        <p style="font-size: 0.7rem;">مدرسة صلالة الشرقية (5-10)</p>
    </div>
    <div style="font-size: 0.7rem; text-align: left;">سلطنة عُمان<br>وزارة التربية والتعليم</div>
</header>

<div class="container">
    <section id="searchBox" class="no-print">
        <h2 style="margin-bottom: 20px; color: var(--oman-green);">استعلام النتائج</h2>
        <input type="text" id="civilID" placeholder="أدخل الرقم المدني">
        <button class="btn-main" onclick="startSearch()">تحليل النتيجة</button>
    </section>

    <section id="resultView">
        <div class="result-card">
            <h2 id="stName" style="color: var(--oman-green); margin-bottom: 5px;">اسم الطالب</h2>
            <p id="stMeta" style="color: var(--oman-gold); font-weight: bold; margin-bottom: 20px;"></p>
            
            <table>
                <thead>
                    <tr><th>المادة</th><th style="text-align:center">الدرجة</th><th>التقدير</th></tr>
                </thead>
                <tbody id="stTable"></tbody>
            </table>
        </div>
        <div style="text-align:center; margin-top:20px;" class="no-print">
            <button onclick="window.print()" style="background:none; border:2px solid var(--oman-green); color:var(--oman-green); padding:8px 25px; border-radius:10px; cursor:pointer; font-weight:bold;">طباعة كشف الدرجات</button>
        </div>
    </section>
</div>

<div id="aiComponent" class="no-print">
    <div class="floating-analysis" id="analysisCard">
        <div class="analysis-h"><i class="fa-solid fa-microchip"></i> تحليل الأداء الذكي</div>
        <div id="analysisContent"></div>
        <button onclick="toggleAnalysis()" style="margin-top:15px; width:100%; background:var(--oman-green); color:white; border:none; padding:8px; border-radius:10px; cursor:pointer; font-size:0.8rem;">إغلاق التحليل</button>
    </div>
    
    <div style="background:var(--oman-green); color:white; font-size:0.6rem; padding:4px 10px; border-radius:10px; margin-bottom:8px; border:1px solid var(--oman-gold);">اضغط للتحليل</div>
    <div class="robot-btn" onclick="toggleAnalysis()">
        <img src="https://pollinations.ai/p/friendly%20robot%20avatar%20gold%20and%20green%20colors%20minimalist?width=100&height=100&nologo=true" alt="Robot">
    </div>
</div>

<script>
    let student = null;

    async function startSearch() {
        const id = document.getElementById('civilID').value.trim();
        const files = ["grade5.json", "grade6.json", "grade7.json", "grade8.json", "grade9.json"];
        for(let f of files) {
            try {
                const r = await fetch(f);
                const data = await r.json();
                student = data.find(s => s["رقم_مدني"].toString() === id);
                if(student) { 
                    prepareUI();
                    return; 
                }
            } catch(e) {}
        }
        alert("الرقم المدني غير مسجل.");
    }

    function prepareUI() {
        const subs = Object.keys(student).filter(k => !["رقم_مدني", "الاسم", "الصف", "الشعبة"].includes(k));
        const scores = subs.map(s => parseFloat(student[s]));
        const avg = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);

        document.getElementById('stName').innerText = student["الاسم"];
        document.getElementById('stMeta').innerText = `الصف: ${student["الصف"]} / الشعبة: ${student["الشعبة"]} | المعدل: ${avg}%`;
        
        document.getElementById('stTable').innerHTML = subs.map(s => `
            <tr>
                <td>${s}</td>
                <td align="center" style="color:var(--oman-green)">${student[s]}</td>
                <td><span class="tag">${student[s]>=90?'امتياز':student[s]>=80?'جيد جداً':'جيد'}</span></td>
            </tr>`).join('');

        document.getElementById('searchBox').style.display = 'none';
        document.getElementById('resultView').style.display = 'block';
        document.getElementById('aiComponent').style.display = 'flex';

        // إعداد محتوى البطاقة العائمة
        const bestSub = subs[scores.indexOf(Math.max(...scores))];
        document.getElementById('analysisContent').innerHTML = `
            <div class="analysis-item"><b>نقطة القوة:</b> أنت متألق جداً في مادة <span style="color:var(--oman-green)">(${bestSub})</span>، استمر في هذا الإبداع!</div>
            <div class="analysis-item"><b>المعدل العام:</b> معدلك هو <span style="color:var(--oman-gold)">${avg}%</span> وهو مؤشر ممتاز لمستقبلك الدراسي.</div>
            <div class="analysis-item"><b>نصيحة المحلل:</b> ركز أكثر على مراجعة المواد العلمية لضمان البقاء في القمة.</div>
        `;
    }

    function toggleAnalysis() {
        const card = document.getElementById('analysisCard');
        card.style.display = (card.style.display === 'block') ? 'none' : 'block';
    }
</script>
</body>
</html>
